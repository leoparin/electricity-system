<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.leo.electricitysystem.mapper.UniformErrorMapper">
    <insert id="insertUniformError">
        INSERT INTO uniform_error(ticket_id,helmet,gloves,uniform,create_time,update_time,img,result)
        values (#{ticketId},#{helmet},#{gloves},#{uniform},Current_Time(),current_time(),#{img},#{result})
    </insert>

    <select id="selectUniformErrorAndNameByUserId" resultType="map">
        -- 查看worker ID = 3的工人的姓名和着装错误
        SELECT ue.description,
               u.user_name
        from
            uniform_error ue
                LEFT JOIN sys_user u on ue.worker_id = u.id
        WHERE worker_id = #{userId};
    </select>

    <select id="getUniformErrorByWorkerIdAndTime" resultType="com.leo.electricitysystem.VO.UniformErrorResult">
        select *
        from worker_uniform_error_view ue
        where ue.worker_id = #{id}
        and DATE_SUB(CURRENT_DATE(),INTERVAL #{month} month) &lt;= create_time;
    </select>

    <select id="getUniformErrorTicketNum" resultType="java.lang.Integer">
        select count(distinct ue.create_time)
        from worker_uniform_error_view ue
        where ue.worker_id = #{id}
          and DATE_SUB(CURRENT_DATE(),INTERVAL #{month} month) &lt;= create_time;
    </select>

</mapper>